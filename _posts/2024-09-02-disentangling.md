---
title: Disentangling transmission lines
author: Fernando Valadares
layout: post
---
Transmission lines (TLs) are the backbone of any radio-frequency (RF) circuit. For anyone using RF signals to control quantum systems such as superconducting circuits, the transmission lines will be the ones connecting the grubby, classical outside world with the low-noise environment of the dilution refrigerator.

Most of the time, TLs such as SMA cables are just bought off the shelf and used without much thought - not even with a glance at the specs sheet. This is almost aways perfectly fine. But sometimes when working with superconducting circuits, understanding the nuances of TL physics is necessary to engineer the systems more accurately. For example, on-chip filters are often designed solely based on a bunch of connected TLs. And that’s when the false familiarity of everyday use leads to confusion. 

My purpose is to give the basic tools researchers need to design transmission lines in superconducting circuits. This knowledge could be used to design qubit control lines, on-chip filters and resonators, or simply help better understand how electromagnetic fields behave at circuit level. I will split the story into two post: the first one will explain some of the physics behind TLs. The second post will show how to design transmission lines in superconducting circuits using finite-element simulations.

As a guideline, in this post I will comment on a few confusion points that I sometimes see in the laboratory. We will build some intuitive understanding of transmission lines, and explore some relevant circuit equations.

# Table of Contents
* TOC
{:toc}

{% include image.liquid url="/assets/disentangling-TL_circuit.pdf" %}

# Transmission lines are not just DC wires
What is the difference between the two images below?

The image on the left is a common DC circuit. The voltage along each wire is constant by definition, following the electrostatics assumption that every point of a conductor shares the same potential.  

The right image shows a very similar circuit, but the connection between the source and the load is done through a transmission line. The only physical difference between both models is that we lift the electrostatic assumption. Let me explain why. 

If the signal generated by the source is fast-changing, it takes finite time to travel through the line. The voltage of the conductor doesn’t have time to settle, forming a travelling wave. Since the wave propagation is not instantaneous, we need to take into account the line length L and the signal propagation speed characterized by the relative permittivity $\varepsilon_r$. That’s when the transmission line model comes in hand.

Following this argument, it is easy to see that the transmission line behaves as a DC wire at the limit of short lengths L. Conversely, this approximation is also valid when the signal is composed of low frequencies, meaning the maximum wavelength $\lambda$ is much smaller than L.

# TLs don’t need a closed loop to carry signals

This is another confusion that arises from comparing RF circuits with their DC counterparts. Let’s check the circuit again, but now assuming that the circuit is open.

We know the open DC wires simply don’t carry any current. The voltage drop at the terminals is equal to the voltage provided by the source. 

Now assume the source sends a high-frequency signal through a long line. We know this signal will take some time to travel to the other end and “feel” the open circuit. This means that, at any point in time:

1. The voltage at the open end is not necessarily equal to the source, and 
2. The current provided by the source is not necessarily zero

In other words, even if the circuit is open, it is possible to send a voltage or current signal down the line. 

This thought experiment also reveals another very interesting effect. As the source now provides non-zero voltage and current, it is as if the transmission line has “transformed” the open load $Z_L \to \infty$ into a finite *input impedance* $Z_{in} < \infty$. 

This impedance transformation follows the notorious formula:

$$
Z_{in}(f) = Z_0\frac{Z_L + jZ_0\tan(\frac{2\pi}{c}\sqrt{\epsilon_r}fL)}{Z_0 + jZ_L\tan(\frac{2\pi}{c}\sqrt{\epsilon_r}fL)}
$$

Here $Z_{in}$ is the impedance perceived at the start of the TL, $f$ is the frequency of a spectral component of the signal, $Z_L$ is an arbitrary load at the end of the line, $c/\sqrt{\varepsilon_r}$ is the signal propagation speed, $L$  is the line length and $Z_0$ is the *characteristic impedance* of the line. We explore the last property in the next point. 

From this formula, we can verify one of our previous conclusions: when $L\ll \lambda = \frac{c}{\sqrt{\varepsilon_r}f}$, the transmission line approximately behaves as a DC wire since $Z_{in}(f) \to Z_L$ for any frequency.

# Transmission lines have real impedances - which doesn’t mean they are lossy

We just learned that transmission lines have an extra parameter called its characteristic impedance $Z_0$, which comes in the formula for $Z_{in}$. 

A common misunderstanding is thinking that $Z_0$ represents a circuit element, and that the line should be somehow lossy when $\textnormal{Re}(Z_0) \neq 0$. But that is not true. An open circuit is lossless for any $Z_0$ (check that $Z_L \to \infty$  means $Z_{in}$ is always imaginary). So what is the actual meaning of $Z_0$?

While $Z_0$ is an impedance like any other, it actually quantifies the relation between the electric and magnetic fields $\vec{E}$ and $\vec{H}$ travelling down between the two wires of the TL:

$$
Z_0(x) = \frac{|\vec{E}(x)|}{|\vec{H}(x)|}
$$

For a homogeneous line, $Z_0$ is independent of the position $x$. We can show that $|\vec{E}|\propto V^+$ and $|\vec{H}|\propto I^+$, where $V^+$ and $I^+$ are the voltage drop and a current waves travelling in the same direction as the electromagnetic wave (denoted as $+$). We can then show that:

$$
Z_0 = \frac{V^+(x)}{I^+(x)}
$$

The impedance is the same if the wave is travelling in the opposite direction (labelled as $-$), so:

$$
Z_0 = -\frac{V^-(x)}{I^-(x)}
$$

The minus signal accounts for the current flipping directions. At any point $x$, the voltage is given by the sum $V^+(x) + V^-(x)$, while the current is given by  $I^+(x) - I^-(x)$. The input impedance at that point is therefore

$$
Z_{in}(x) = \frac{V^+(x) + V^-(x)}{I^+(x) - I^-(x)}.
$$

With a bit more of derivation and assuming harmonic oscillations, we can derive the previously shown equation for $Z_{in}$.

So what is $Z_0$? A *wave impedance*. Its “reality” is not associated losses through Ohms law, as with regular resistors. Instead, it quantifies how a wave propagates through space. But some food for thought: if the energy carried by a wave with impedance $Z_0$ is never reflected back and leaves the circuit (imagine an infinite transmission line), then this propagation can in fact be interpreted as a loss to a resistor $Z_0$. This is equivalent to assuming $Z_L = Z_0$, leading to $Z_{in} = Z_0$.

# Conclusion
I hope to have help you build some intuition on how transmission lines behave and how they build up on DC circuits. Although my explanations are not comprehensive in any way, they should provide an initial understanding for those who want to venture further into the matter. But most importantly: always remember the difference between the load impedance $Z_L$, the characteristic impedance $Z_0$ and the input impedance $Z_{in}$.

In the next post, I will show how to measure and design all of the properties of a transmission line, and show how it can be used to design filters. Until then!

**1\. Numerate all the nodes of the circuit and define the variables $Q_k$ and $i_k$ for the $k$-th node.**

In the case of the resonator, there is only one pair of $Q$ and $i = \dot{Q}$.

**2\. Write the Lagrangian in terms of these variables $L(Q_k, i_k, t) = T - V$. T and V are the kinetic and potential energies of the system, respectively.**

The kinetic energy is the capacitive energy $T = E_C$, while the potential energy is the inductive energy $V = E_L$. Our lagrangian is

$$L(Q, i) = \frac{Q^2}{2C} - \frac{L i^2}{2}$$

**3\. Calculate the generalized momentum $p_k$ of each charge** $Q_k$: $p_k = \frac{\partial L}{\partial i_k}$

The generalized momentum is $p = -Li = \phi$!

**4\. Apply the Legendre transform to the Lagrangian to obtain the classical Hamiltonian: $H(Q_k, p_k, t) = L - \sum_k p_k i_k$**

In this step, we have to remember to rewrite every $i_k$ in terms of its momentum. The solution is again very simple for the resonator:

$$H(Q, \phi) = \frac{Q^2}{2C} - \frac{Li^2}{2} - \phi i = \frac{Q^2}{2C} + \frac{\phi^2}{2L} $$

The Hamiltonian is essentially the total energy $E_C + E_L$ in terms of $Q$ and $\phi$. It is common to jump to this step and simply write the Hamiltonian as the total energy, and it is correct most of the time. But this might not be so easy to do in more complicated systems, so I decided to show how to get here in the correct way.

**5\. Quantize the Hamiltonian by replacing the variables $Q_k$ and $\phi_k$ by operators $\hat{Q}_k$ and $\hat{\phi}_k$ such that** $\[\hat{Q}_k, \hat{\phi}_k\] = i\hbar$

This step is sometimes called "first quantization". It is a simple substitution that makes the function $H(Q, \phi)$ into an operator $\hat{H}(\hat{Q}, \hat{\phi})$. The Hamiltonian of a superconducting resonator then is:

$$\hat{H} = \frac{\hat{Q}^2}{2C} + \frac{\hat{\phi}^2}{2L}$$

As expected, this is the Hamiltonian of a quantum harmonic oscillator. We can rewrite the operators as functions of ladder operators:

$$\hat{\phi} = \sqrt{\frac{\hbar}{2C\omega_r}}(\hat{a}^{\dagger} + \hat{a}), \ \hat{Q} = i \sqrt{\frac{\hbar C \omega_r}{2}} (\hat{a}^{\dagger} - \hat{a}),$$

so the Hamiltonian is rewritten as (dropping hats and the constant $1/2$ factor and setting $\hbar = 1$)

$$H = \omega_r a^\dagger a$$

This is the typical form we treat resonators in circuit QED. Many other circuits will include an $a^{\dagger} a$ term in its Hamiltonian, and we frequently use this term to implicitly model the environment. Because it is so common, we need to know how to simplify systems in which two harmonic oscillator terms are coupled.

# Diagonalizing coupled resonators

When two superconducting resonators are put geometrically close, their fields overlap. The electromagnetic field generated by current and charge accumulation in one resonator will induce current and charge in the other. That is called capacitive coupling and is how two superconducting circuits can interact with each other. Let's start by deriving the capacitive coupling term to understand how it works.

## Capacitive coupling

{% include image.liquid url="/assets/resonator-qed_coupled.png" %}

The circuit in the figure above shows two LC circuits A and B whose nodes are connected by a gate capacitance $C_g$. Let us define $V_A$, $V_B$ and $V_g$ as the voltages over each element, with orientations such that Kirchhoff voltage law reads as

$$V_1 + V_2 + V_3 = 0.$$

In terms of flux, we have

$$\dot{\phi}_g + \dot{\phi}_A + \dot{\phi}_B = 0$$

$$\rightarrow \dot{\phi}_g = - \dot{\phi}_A - \dot{\phi}_B$$

Following the quantization procedure in the last section and substituting $\dot{\phi_g}$, the Lagrangian is

$$ L = \frac{C_A}{2}\dot{\phi}_A^2 + \frac{C_B}{2}\dot{\phi}_B^2 +  \frac{C_g}{2}(\dot{\phi}_A + \dot{\phi}_B)^2 -\frac{\phi_B^2}{2L_B} -\frac{\phi_A^2}{2L_A}$$

The conjugate momenta to $\phi_A$ and $\phi_B$ are, respectively:

$$Q_A = \frac{\partial L}{\partial\dot{\phi}_A} = (C_A + C_g)\dot{\phi}_A + C_g\dot{\phi}_B,$$

$$Q_B = \frac{\partial L}{\partial\dot{\phi}_B} = (C_B + C_g)\dot{\phi}_B + C_g\dot{\phi}_A.$$

These equations are not as trivial to find if not following the step-by-step quantization. Rewriting in terms of the first flux derivative:

$$\dot{\phi}_A = \frac{C_A + C_g}{D}Q_A - \frac{C_g}{D}Q_B,$$

$$\dot{\phi}_B = \frac{C_B + C_g}{D}Q_B - \frac{C_g}{D}Q_A,$$

where $D = C_AC_B + C_AC_g + C_BC_g$. Now we get the Hamiltonian in terms of $\phi_A$, $\phi_B$, Q$_A$ and Q$_B$:

$$H = \dot{\phi}_AQ_A + \dot{\phi}_BQ_ B - L = H_A + H_B + H_g.$$

$H_A$ and $H_B$ are each resonator's term, while $H_g$ describes the coupling between them: 

$$H_A = \frac{C_A + C_g}{2D}Q_A^2 + \frac{1}{2L_R}\phi_A^2,$$

$$H_B = \frac{C_B + C_g}{2D}Q_B^2 + \frac{1}{2L_R}\phi_B^2,$$

$$H_g = -\frac{C_g}{D}Q_AQ_B.$$

Finally, we quantize the canonical variables by substituting for operators $Q_i \rightarrow \hat{Q}_i$, $\phi \rightarrow \hat{\phi}_i$. We can further develop the Hamiltonian by defining ladder operators $\hat{a}$,  $\hat{b}$ that diagonalize $H_A$ and $H_B$, leading to ($\hbar = 1$)

$$H = w_A a^{\dagger}a + w_Bb^{\dagger}b - g \left(a^{\dagger} - a\right)\left(b^{\dagger} - b\right).$$

The capacitive coupling Hamiltonian is represented by a coupling factor $g$, which has the value

$$g = \frac{C_g}{2D} \sqrt{\frac{C_AC_B}{L_AL_B}}.$$

The capacitive coupling is a very important term in circuit QED. The interactions between circuits, and of these with external drives, are usually described by this Hamiltonian for a given factor $g$. It is then essential to understand how to deal with this term once it shows up. In the next section, I will show how we can redefine the ladder operators to hybridize the modes $\hat{a}$ and $\hat{b}$, making the coupling term vanish.

Before we proceed, I want to introduce a simplifying approximation that is also a very frequently used technique. Expanding the capacitive coupling term gives

$$H_g = -g (a^{\dagger}b^{\dagger} + ab - a^{\dagger}b - ab^{\dagger}).$$

There are two types of terms here: the co-rotating terms $a^{\dagger}b$, $ab^{\dagger}$, and the counter-rotating terms $a^{\dagger}b^{\dagger}$, $ab$. There are many ways to interpret these two types of terms, so I will offer one explanation. The co-rotating terms describe an evolution where one excitation is removed from one of the resonators while one excitation is created in the other resonator. The energy required to activate such dynamics is $\hbar (\omega_A - \omega_B) $, which is the difference in energy between the excitations. Meanwhile, the counter-rotating terms describe the simultaneous gain ($a^{\dagger}b^{\dagger}$) or loss ($ab$) of excitations from both resonators, implying a change of energy of magnitude $\hbar (\omega_A + \omega_B)$. As we work in a regime where $\omega_A \approx \omega_B$, the counter-rotating terms have a much higher "energy cost". Unless $g$ has a relatively high value ($g 	\gtrsim \omega_A + \omega_B$), we can safely ignore them. This is called the rotating wave approximation (RWA) and it leaves only the co-rotating terms in the Hamiltonian:

$$H \approx w_A a^{\dagger}a + w_Bb^{\dagger}b + g(a^{\dagger}b + ab^{\dagger})$$

## Hybridization of coupled resonant modes

Let's go back to our uncoupled (bare) resonator modes $\omega_A a^{\dagger}a$ and $\omega_B b^{\dagger}b$. As seen in the last section, they come from two separate LC circuits with resonance frequencies $\omega_{A, B}$. However, once they are connected by a gate capacitance $C_g$, the resonant modes are disturbed and $\omega_{A, B}$ stop being resonance frequencies of the system. We want to find the new resonant modes with frequencies $\tilde{\omega}_{A,B}$, and that turns out to always be possible through a mindful redefinition $\hat{a} \rightarrow \tilde{a}$, $\hat{b} \rightarrow \tilde{b}$.

Rewriting the Hamiltonian (after the RWA) in the matrix form:

$$H = \begin{pmatrix} a^{\dagger} && b^{\dagger} \end{pmatrix}\begin{pmatrix} \omega_A && -g \\ -g && \omega_B \end{pmatrix} \begin{pmatrix} a\\ b \end{pmatrix}$$

Turns out the Hamiltonian is described by a symmetric matrix, that is, equal to its transpose. Symmetric matrices with non-degenerate eigenvalues always have orthogonal eigenvectors - this means they can be diagonalized just by frame rotation. So there exists a rotation angle $\Lambda$ such that

$$\begin{pmatrix} \cos\Lambda && \sin\Lambda \\ -\sin\Lambda && \cos\Lambda \end{pmatrix} \begin{pmatrix} \omega_A && -g \\ -g && \omega_B \end{pmatrix} \begin{pmatrix} \cos\Lambda && -\sin\Lambda \\ \sin\Lambda && \cos\Lambda \end{pmatrix} = \begin{pmatrix} \tilde{\omega}_A && 0 \\ 0 && \tilde{\omega}_B\end{pmatrix}$$

That is, in such a frame, there are two decoupled resonant modes with frequencies $\tilde{\omega}_{A,B}$. The ladder operators of the new resonant modes are calculated from the change of frame

$$\begin{pmatrix}\tilde{a} \\ \tilde{b} \end{pmatrix} = \begin{pmatrix}\cos\Lambda & \sin\Lambda \\-\sin\Lambda & \cos\Lambda\end{pmatrix} \begin{pmatrix}a \\b\end{pmatrix}, $$

so that the resonant new modes are hybridizations of the previous modes: e.g. $\tilde{a} = \cos\Lambda a + \sin\Lambda b$. 

This procedure can be readily generalized to more than two resonators. In fact, the same technique is used to deal with the linear terms of nonlinear circuits such as qubits, simplifying qubit-resonator or qubit-qubit hamiltonians.

# Conclusion

We have gone through the mathematical details of treating a resonator in circuit QED. We covered the quantization procedure from ground-up, through which the resonator reveals the dynamics of a quantum harmonic oscillator. Then, we saw how two resonators can be coupled together and how to simplify the Hamiltonian in such cases. 

The resonator is too simple of a circuit, and we can't do quantum computation by relying only on them. So, in the future, I will write about how we can model transmons in cQED and how we can use them to make qubits. The knowledge from this post will be essential, so try to develop the equations yourself. 加油!
